# üöÄ Guide de D√©ploiement BeSuccess sur Hostinger

**Date** : 14 Octobre 2025  
**Plateforme** : Hostinger VPS ou Cloud Hosting  
**Application** : BeSuccess - Sortie de zone de confort

---

## üìã Table des Mati√®res

1. [Pr√©requis](#pr√©requis)
2. [Choix de l'h√©bergement](#choix-h√©bergement)
3. [Pr√©paration du code](#pr√©paration-code)
4. [Configuration du serveur](#configuration-serveur)
5. [D√©ploiement](#d√©ploiement)
6. [Configuration DNS](#configuration-dns)
7. [SSL/HTTPS](#ssl-https)
8. [Maintenance](#maintenance)
9. [Troubleshooting](#troubleshooting)

---

## üéØ Pr√©requis

### Ce dont vous avez besoin

- ‚úÖ Compte Hostinger actif
- ‚úÖ Nom de domaine (ex: besuccess.com)
- ‚úÖ Acc√®s SSH au serveur
- ‚úÖ Code source pr√™t sur GitHub

### Recommandations Hostinger

Pour une application Node.js, vous avez besoin de :

**Option 1 : VPS Hosting** (Recommand√©) ‚≠ê
- KVM 1 ou sup√©rieur
- 1 GB RAM minimum (2 GB recommand√©)
- 20 GB SSD
- Ubuntu 20.04 ou 22.04
- **Prix** : ~4-8‚Ç¨/mois

**Option 2 : Cloud Hosting**
- Cloud Startup ou sup√©rieur
- Support Node.js int√©gr√©
- **Prix** : ~10-15‚Ç¨/mois

**Option 3 : H√©bergement Partag√©** ‚ùå
- Ne supporte PAS Node.js
- Ne convient PAS pour cette application

---

## üèóÔ∏è Choix de l'H√©bergement

### √âtape 1 : Commander un VPS

1. Allez sur https://www.hostinger.fr
2. Cliquez sur **VPS Hosting**
3. Choisissez **KVM 1** ou sup√©rieur
4. S√©lectionnez :
   - OS : **Ubuntu 22.04 64-bit**
   - Localisation : **Europe** (pour performance)
   - P√©riode : Au choix
5. Validez la commande

### √âtape 2 : Acc√©der au VPS

Apr√®s l'activation (quelques minutes), vous recevrez :
```
IP du serveur : 123.456.789.012
Utilisateur SSH : root
Mot de passe SSH : xxxxxxxxxx
```

---

## üõ†Ô∏è Pr√©paration du Code

### 1. Cr√©er un fichier de configuration production

Cr√©ez `.env.production` :

```bash
# Configuration Production
NODE_ENV=production
PORT=3000
ADMIN_PORT=3001

# Database
DB_PATH=/var/www/besuccess/database/challenges.db

# JWT
JWT_SECRET=VOTRE_SECRET_SUPER_SECURISE_ICI_CHANGEZ_MOI

# URLs
DOMAIN=https://besuccess.com
ADMIN_DOMAIN=https://admin.besuccess.com

# Uploads
MAX_FILE_SIZE=52428800
UPLOAD_PATH=/var/www/besuccess/uploads

# Session
SESSION_SECRET=AUTRE_SECRET_SUPER_SECURISE_CHANGEZ_MOI
```

### 2. Cr√©er scripts de d√©marrage

Cr√©ez `package.json` scripts :

```json
{
  "scripts": {
    "start": "node server/index.js",
    "start:admin": "node server/admin.js",
    "start:prod": "pm2 start ecosystem.config.js",
    "stop:prod": "pm2 stop all",
    "restart:prod": "pm2 restart all",
    "logs": "pm2 logs"
  }
}
```

### 3. Cr√©er fichier PM2

Cr√©ez `ecosystem.config.js` :

```javascript
module.exports = {
  apps: [
    {
      name: 'besuccess-user',
      script: './server/index.js',
      instances: 1,
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production',
        PORT: 3000
      }
    },
    {
      name: 'besuccess-admin',
      script: './server/admin.js',
      instances: 1,
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production',
        PORT: 3001
      }
    }
  ]
};
```

### 4. Cr√©er .gitignore

Assurez-vous d'avoir :

```
node_modules/
.env
.env.production
uploads/*
!uploads/.gitkeep
server/database/*.db
server/database/*.db-*
*.log
.DS_Store
```

### 5. Commit et push

```bash
git add .
git commit -m "üöÄ Pr√©paration d√©ploiement production"
git push origin main
```

---

## üñ•Ô∏è Configuration du Serveur

### √âtape 1 : Connexion SSH

```bash
ssh root@VOTRE_IP_SERVEUR
# Entrer le mot de passe re√ßu par email
```

### √âtape 2 : Mise √† jour du syst√®me

```bash
# Mettre √† jour les paquets
apt update && apt upgrade -y

# Installer les outils essentiels
apt install -y curl git build-essential nginx
```

### √âtape 3 : Installer Node.js

```bash
# Installer Node.js 20.x
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# V√©rifier l'installation
node --version  # Devrait afficher v20.x.x
npm --version   # Devrait afficher 10.x.x
```

### √âtape 4 : Installer PM2

```bash
# PM2 pour g√©rer les processus Node.js
npm install -g pm2

# V√©rifier
pm2 --version
```

### √âtape 5 : Cr√©er utilisateur non-root

```bash
# Cr√©er utilisateur pour l'application
adduser besuccess
usermod -aG sudo besuccess

# Basculer sur cet utilisateur
su - besuccess
```

### √âtape 6 : Cr√©er structure de dossiers

```bash
# Cr√©er dossiers
sudo mkdir -p /var/www/besuccess
sudo chown -R besuccess:besuccess /var/www/besuccess
cd /var/www/besuccess
```

---

## üì¶ D√©ploiement

### M√©thode 1 : Avec Git (Recommand√©)

```bash
# Cloner le repository
cd /var/www/besuccess
git clone https://github.com/Romindigo/BeSuccess-Deploy.git .

# Installer les d√©pendances
npm ci --production

# Cr√©er dossiers n√©cessaires
mkdir -p uploads/photos uploads/videos uploads/profiles
mkdir -p server/database

# Copier et configurer .env
nano .env.production
# Coller la configuration et modifier les secrets

# Renommer en .env
mv .env.production .env
```

### M√©thode 2 : Upload manuel (Alternative)

```bash
# Sur votre machine locale
cd /Users/romainlimare/CascadeProjects/windsurf-project
tar -czf besuccess.tar.gz --exclude='node_modules' --exclude='.git' .

# Upload via SCP
scp besuccess.tar.gz besuccess@VOTRE_IP:/var/www/besuccess/

# Sur le serveur
cd /var/www/besuccess
tar -xzf besuccess.tar.gz
rm besuccess.tar.gz
npm ci --production
```

### √âtape 7 : Initialiser la base de donn√©es

```bash
cd /var/www/besuccess

# Cr√©er la base de donn√©es
node server/database/init-db.js

# Ex√©cuter migrations
node server/database/migrate-groups.js

# Cr√©er comptes de test
node server/scripts/create-test-users.js
```

### √âtape 8 : D√©finir les permissions

```bash
# Permissions correctes
sudo chown -R besuccess:besuccess /var/www/besuccess
chmod -R 755 /var/www/besuccess
chmod -R 775 /var/www/besuccess/uploads
chmod 600 /var/www/besuccess/.env
```

---

## üåê Configuration Nginx

### √âtape 1 : Cr√©er configuration Nginx

```bash
sudo nano /etc/nginx/sites-available/besuccess
```

Collez :

```nginx
# Configuration pour le site utilisateur
server {
    listen 80;
    server_name besuccess.com www.besuccess.com;
    
    client_max_body_size 50M;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    location /uploads {
        alias /var/www/besuccess/uploads;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}

# Configuration pour l'admin
server {
    listen 80;
    server_name admin.besuccess.com;
    
    client_max_body_size 50M;
    
    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### √âtape 2 : Activer la configuration

```bash
# Cr√©er lien symbolique
sudo ln -s /etc/nginx/sites-available/besuccess /etc/nginx/sites-enabled/

# Supprimer config par d√©faut
sudo rm /etc/nginx/sites-enabled/default

# Tester la configuration
sudo nginx -t

# Red√©marrer Nginx
sudo systemctl restart nginx
```

---

## üîí Configuration DNS

### Sur Hostinger Panel

1. Allez dans **Domaines** ‚Üí Votre domaine
2. Cliquez sur **G√©rer les DNS**
3. Ajoutez ces enregistrements :

```
Type    Nom     Valeur                  TTL
A       @       VOTRE_IP_SERVEUR        3600
A       www     VOTRE_IP_SERVEUR        3600
A       admin   VOTRE_IP_SERVEUR        3600
```

4. Sauvegardez et attendez propagation (5-30 minutes)

### V√©rifier DNS

```bash
# Sur votre machine
nslookup besuccess.com
nslookup admin.besuccess.com
```

---

## üîê SSL/HTTPS avec Let's Encrypt

### √âtape 1 : Installer Certbot

```bash
sudo apt install -y certbot python3-certbot-nginx
```

### √âtape 2 : Obtenir certificats SSL

```bash
# Pour les deux domaines
sudo certbot --nginx -d besuccess.com -d www.besuccess.com -d admin.besuccess.com

# Suivre les instructions :
# - Entrer email
# - Accepter les conditions
# - Choisir redirection HTTPS (option 2)
```

### √âtape 3 : Renouvellement automatique

```bash
# Tester le renouvellement
sudo certbot renew --dry-run

# Le renouvellement automatique est d√©j√† configur√©
# V√©rifie : /etc/cron.d/certbot
```

---

## üöÄ D√©marrage de l'Application

### √âtape 1 : D√©marrer avec PM2

```bash
cd /var/www/besuccess

# D√©marrer les applications
pm2 start ecosystem.config.js

# V√©rifier le statut
pm2 status

# Voir les logs
pm2 logs
```

### √âtape 2 : Configuration d√©marrage automatique

```bash
# Sauvegarder la configuration PM2
pm2 save

# Cr√©er script de d√©marrage
pm2 startup

# Copier et ex√©cuter la commande affich√©e
# Elle ressemblera √† :
# sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u besuccess --hp /home/besuccess
```

### √âtape 3 : Tester

Ouvrez votre navigateur :
- **Site utilisateur** : https://besuccess.com
- **Admin** : https://admin.besuccess.com

---

## üìä Commandes Utiles

### PM2

```bash
# Voir le statut
pm2 status

# Voir les logs
pm2 logs
pm2 logs besuccess-user
pm2 logs besuccess-admin

# Red√©marrer
pm2 restart all
pm2 restart besuccess-user

# Arr√™ter
pm2 stop all

# Informations d√©taill√©es
pm2 info besuccess-user

# Monitoring
pm2 monit
```

### Nginx

```bash
# Tester la configuration
sudo nginx -t

# Red√©marrer
sudo systemctl restart nginx

# Status
sudo systemctl status nginx

# Voir les logs
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### Syst√®me

```bash
# Espace disque
df -h

# Utilisation RAM
free -h

# Processus
htop

# Logs syst√®me
journalctl -xe
```

---

## üîÑ Mises √† Jour

### D√©ployer une mise √† jour

```bash
# Se connecter au serveur
ssh besuccess@VOTRE_IP

# Aller dans le dossier
cd /var/www/besuccess

# R√©cup√©rer les modifications
git pull origin main

# Installer nouvelles d√©pendances
npm ci --production

# Red√©marrer les applications
pm2 restart all

# V√©rifier
pm2 status
pm2 logs
```

### Script de d√©ploiement automatique

Cr√©ez `deploy.sh` :

```bash
#!/bin/bash
echo "üöÄ D√©ploiement en cours..."

cd /var/www/besuccess
git pull origin main
npm ci --production
pm2 restart all

echo "‚úÖ D√©ploiement termin√©!"
pm2 status
```

Rendez-le ex√©cutable :

```bash
chmod +x deploy.sh
./deploy.sh
```

---

## üíæ Sauvegardes

### Script de sauvegarde base de donn√©es

Cr√©ez `backup.sh` :

```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/var/www/besuccess/backups"
mkdir -p $BACKUP_DIR

# Backup database
cp /var/www/besuccess/server/database/challenges.db $BACKUP_DIR/challenges_$DATE.db

# Backup uploads
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz /var/www/besuccess/uploads

# Garder seulement les 7 derniers jours
find $BACKUP_DIR -name "*.db" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "‚úÖ Backup termin√©: $DATE"
```

### Cron pour sauvegardes automatiques

```bash
# Editer crontab
crontab -e

# Ajouter (backup tous les jours √† 2h du matin)
0 2 * * * /var/www/besuccess/backup.sh >> /var/log/besuccess-backup.log 2>&1
```

---

## üî• Troubleshooting

### Probl√®me 1 : Site inaccessible

```bash
# V√©rifier PM2
pm2 status
pm2 logs

# V√©rifier Nginx
sudo systemctl status nginx
sudo nginx -t

# V√©rifier ports
sudo netstat -tulpn | grep -E '(3000|3001|80|443)'
```

### Probl√®me 2 : Erreur 502 Bad Gateway

```bash
# Les applications Node.js ne tournent pas
pm2 restart all

# V√©rifier les logs
pm2 logs

# V√©rifier Nginx
sudo tail -f /var/log/nginx/error.log
```

### Probl√®me 3 : Upload ne fonctionne pas

```bash
# V√©rifier permissions
ls -la /var/www/besuccess/uploads

# Corriger si n√©cessaire
sudo chown -R besuccess:besuccess /var/www/besuccess/uploads
chmod -R 775 /var/www/besuccess/uploads

# V√©rifier Nginx client_max_body_size
sudo nano /etc/nginx/sites-available/besuccess
# Doit avoir : client_max_body_size 50M;
```

### Probl√®me 4 : Base de donn√©es verrouill√©e

```bash
# V√©rifier processus utilisant la DB
lsof /var/www/besuccess/server/database/challenges.db

# Red√©marrer applications
pm2 restart all
```

### Probl√®me 5 : Certificat SSL expir√©

```bash
# Renouveler manuellement
sudo certbot renew

# Forcer renouvellement
sudo certbot renew --force-renewal

# Red√©marrer Nginx
sudo systemctl restart nginx
```

---

## üìà Monitoring et Performance

### Installer monitoring

```bash
# Installer monitoring PM2
pm2 install pm2-logrotate

# Configurer rotation des logs
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
```

### Monitoring avec PM2 Plus (Optionnel)

```bash
# Cr√©er compte sur https://app.pm2.io
# Puis connecter
pm2 link PRIVATE_KEY PUBLIC_KEY
```

---

## üîê S√©curit√©

### Firewall

```bash
# Installer UFW
sudo apt install -y ufw

# Configurer
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Activer
sudo ufw enable

# V√©rifier
sudo ufw status
```

### Fail2Ban

```bash
# Installer
sudo apt install -y fail2ban

# Configurer
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo nano /etc/fail2ban/jail.local

# Activer
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### Mises √† jour automatiques

```bash
# Installer
sudo apt install -y unattended-upgrades

# Configurer
sudo dpkg-reconfigure --priority=low unattended-upgrades
```

---

## ‚úÖ Checklist de D√©ploiement

### Avant d√©ploiement
- [ ] Code test√© en local
- [ ] `.env.production` configur√©
- [ ] Secrets JWT/Session chang√©s
- [ ] Code push√© sur GitHub
- [ ] VPS Hostinger command√©
- [ ] Domaine configur√©

### Pendant d√©ploiement
- [ ] Serveur mis √† jour
- [ ] Node.js install√©
- [ ] PM2 install√©
- [ ] Code d√©ploy√©
- [ ] D√©pendances install√©es
- [ ] Base de donn√©es initialis√©e
- [ ] Nginx configur√©
- [ ] DNS configur√©
- [ ] SSL install√©
- [ ] Applications d√©marr√©es

### Apr√®s d√©ploiement
- [ ] Site accessible (https://besuccess.com)
- [ ] Admin accessible (https://admin.besuccess.com)
- [ ] Upload photos/vid√©os fonctionnel
- [ ] Connexion/inscription OK
- [ ] D√©fis affich√©s
- [ ] Groupes fonctionnels
- [ ] Sauvegardes configur√©es
- [ ] Monitoring actif
- [ ] Firewall configur√©

---

## üí∞ Co√ªts Estim√©s

### Hostinger VPS
- **KVM 1** : ~4‚Ç¨/mois
- **KVM 2** : ~8‚Ç¨/mois (recommand√© si > 100 utilisateurs)
- **KVM 4** : ~15‚Ç¨/mois (pour forte audience)

### Domaine
- **.com** : ~10‚Ç¨/an
- **.fr** : ~10‚Ç¨/an

### SSL
- **Let's Encrypt** : GRATUIT

### Total
- **Minimum** : ~4‚Ç¨/mois + 10‚Ç¨/an domaine
- **Recommand√©** : ~8‚Ç¨/mois + 10‚Ç¨/an domaine

---

## üìû Support

### Hostinger Support
- Chat 24/7 : https://www.hostinger.fr
- Documentation : https://support.hostinger.com
- Tutoriels VPS : https://www.hostinger.fr/tutoriels/vps

### Ressources
- PM2 Doc : https://pm2.keymetrics.io/docs
- Nginx Doc : https://nginx.org/en/docs
- Let's Encrypt : https://letsencrypt.org/docs

---

## üéâ F√©licitations !

Votre application **BeSuccess** est maintenant en ligne et accessible au monde entier ! üöÄ

**URLs** :
- üåê **Site principal** : https://besuccess.com
- üë®‚Äçüíº **Administration** : https://admin.besuccess.com

---

**Date de cr√©ation** : 14 Octobre 2025  
**Version** : 1.0  
**Auteur** : Guide de d√©ploiement BeSuccess
